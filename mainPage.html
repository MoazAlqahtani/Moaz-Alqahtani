<!DOCTYPE html>

<head>
    <title>TechNews</title>
    <link rel="stylesheet" type="text/css" href="myStyle.css">
</head>

<body class="main" onload="getItem()">
    <div id="content">
        <header class="head">
            <ul>
                <li id="news">
                    <img src="./pic/home.png" width=15 alt=Homeicon>
                    <a href="#">TNews</a>
                </li>
                <li>
                    <a href="#">News</a>
                </li>
                <li>
                    <a href="#">Comments</a>
                </li>
                <li>
                    <a href="#">Show</a>
                </li>
                <li>
                    <a href="#">Ask</a>
                </li>
                <li>
                    <a href="#">Jobs</a>
                </li>
                <li>
                    <a href="#">Submit News</a>
                </li>
            </ul>
        </header>
        <div id="mainTitle">
            <h5>Main Stories</h5>
            <h5>10/02/2017</h5>
            <label>sort by
                <select id="selector">
                    <option value="sortN">Newest</option>
                    <option value="sortL">Like</option>
                    <option value="sortC">Comments</option>
                </select>
            </label>

        </div>
        <div id="allList">
            <ul class="newsList">
                <!-- js -->
            </ul>
        </div>
        <footer>
            <p>Â© 2017 HN inc. All Rights Reserved.</p>
            <p>
                <a href="#">Privacy</a>
                <a href="#">Terms of Use</a>
                <a href="#">Contact</a>
                <a href="#"></a>
            </p>
            <p>Written in pure HTML | Hosted By:
                <a href="#"> SadSmile</a>
            </p>
        </footer>
    </div>
    <script>



        var json;
        var arrayObj = []
        function getItem() {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    json = JSON.parse(xhttp.response);
                    var xhttp1 = []
                    for (var i = 0; i < 30; i++) {
                        xhttp1[i] = new XMLHttpRequest();
                        xhttp1[i].open("GET", "https://hacker-news.firebaseio.com/v0/item/" + json[i] + ".json", true);
                        xhttp1[i].onreadystatechange = function () {
                            if (this.readyState == 4 && this.status == 200) {
                                var arrayRe = JSON.parse(this.response);
                                arrayObj.push({ score: arrayRe.score, title: arrayRe.title, URL: arrayRe.URL, time: arrayRe.time, descendants:arrayRe.descendants })
                                var outerUl = document.getElementsByClassName("newsList");
                                outerUl[0].innerHTML = "";
                                sortLoop();
                            }
                        };

                        xhttp1[i].send();

                    }
                }
            };
            xhttp.open("GET", "https://hacker-news.firebaseio.com/v0/topstories.json", true);
            xhttp.send();
        }



        var sortLoop = function () {


            for (var i = 0; i <= arrayObj.length - 1; i++) {
                var time = new Date(arrayObj[i].time * 1000);
                var innerList = document.createElement("li");
                innerList.innerHTML = arrayObj[i].score + " score | " + time + " | " + arrayObj[i].descendants + " Comments";
                var innerUl = document.createElement("ul");
                innerUl.appendChild(innerList);
                var innerA = document.createElement("a");
                innerA.setAttribute("href", "#");
                innerA.innerHTML = arrayObj[i].title;
                var outerLi = document.createElement("li");
                outerLi.setAttribute("class", "lis");
                outerLi.appendChild(innerA);
                outerLi.appendChild(innerUl);
                var outerUl = document.getElementsByClassName("newsList");
                outerUl[0].appendChild(outerLi);

            }
        }

        var selector = document.getElementById("selector");
        selector.addEventListener("click", function () {
            if (selector.value == "sortL") {

                arrayObj.sort(function (first, second) {
                    if (first.score < second.score) {
                        return 1;
                    }
                    return -1;
                })

                var outerUl = document.getElementsByClassName("newsList");
                outerUl[0].innerHTML = "";
                sortLoop();



            } else if (selector.value == "sortC") {

                arrayObj.sort(function (first, second) {
                    if (first.descendants < second.descendants) {
                        return 1;
                    }
                    return -1;
                })

                var outerUl = document.getElementsByClassName("newsList");
                outerUl[0].innerHTML = "";
                sortLoop();



            } else if (selector.value == "sortN") {

                arrayObj.sort(function (first, second) {
                    if (first.time < second.time) {
                        return 1;
                    }
                    return -1;
                })

                var outerUl = document.getElementsByClassName("newsList");
                outerUl[0].innerHTML = "";
                sortLoop();



            }
        })





    </script>
</body>